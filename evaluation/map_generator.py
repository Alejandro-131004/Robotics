# -*- coding: utf-8 -*-
"""
Code for map_generator.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1qKbf-_jMd_R7RvvyqD8Eh_xm19ROJwiA
"""

import os
import numpy as np
import pickle
from environment.configuration import MAX_DIFFICULTY_STAGE, get_stage_parameters

def generate_maps(
    maps_output_dir: str = "evaluation/maps",
    num_maps_per_difficulty: int = 100,
    total_difficulty_stages: int = int(MAX_DIFFICULTY_STAGE)
) -> list:
    """
    Generates a set of tunnel maps for evaluation, saving their parameters.
    Each map is a collection of parameters (num_curves, angle_range, clearance_factor, num_obstacles)
    that define an environment.

    Args:
        maps_output_dir (str): Directory where generated maps will be saved.
        num_maps_per_difficulty (int): Number of maps to generate per difficulty level.
        total_difficulty_stages (int): Total number of difficulty levels (e.g., 10).

    Returns:
        list: A list of file paths to the generated map files.
    """
    print(f"--- Generating {num_maps_per_difficulty * total_difficulty_stages} maps ---")
    os.makedirs(maps_output_dir, exist_ok=True)

    map_files = []

    for difficulty_level in range(1, total_difficulty_stages + 1):
        print(f"Generating {num_maps_per_difficulty} maps for Difficulty {difficulty_level}/{total_difficulty_stages}...")
        for i in range(num_maps_per_difficulty):
            # Get stage parameters using the configuration function
            num_curves, angle_range, clearance_factor, num_obstacles = \
                get_stage_parameters(float(difficulty_level), float(total_difficulty_stages))

            map_params = {
                "difficulty_level": difficulty_level,
                "num_curves": num_curves,
                "angle_range": angle_range,
                "clearance_factor": clearance_factor,
                "num_obstacles": num_obstacles
            }

            map_filename = os.path.join(maps_output_dir, f"map_D{difficulty_level}_N{i+1}.pkl")
            with open(map_filename, 'wb') as f:
                pickle.dump(map_params, f)
            map_files.append(map_filename)

    print(f"Map generation completed. {len(map_files)} maps saved in '{maps_output_dir}'.")
    return map_files

if __name__ == "__main__":
    # Example standalone usage
    MAPS_OUTPUT_DIR = "evaluation/maps_standalone_test"
    NUM_MAPS_PER_DIFFICULTY = 10  # Only 10 maps for quick testing
    TOTAL_DIFFICULTY_STAGES = 2   # Only 2 difficulty levels for quick testing

    generated_map_files = generate_maps(
        maps_output_dir=MAPS_OUTPUT_DIR,
        num_maps_per_difficulty=NUM_MAPS_PER_DIFFICULTY,
        total_difficulty_stages=TOTAL_DIFFICULTY_STAGES
    )
    print(f"\nStandalone map generation test completed. Maps saved in {MAPS_OUTPUT_DIR}")
